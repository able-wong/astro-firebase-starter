---
interface Props {
  currentPath?: string;
}

const { currentPath = '/' } = Astro.props;

const navLinks = [
  { href: '/', label: 'Home' },
  { href: '/about', label: 'About' },
  { href: '/contact', label: 'Contact' },
];
---

<header class="navbar bg-base-100 shadow-sm">
  <div class="navbar-start">
    <div class="dropdown">
      <div tabindex="0" role="button" class="btn btn-ghost lg:hidden">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h8m-8 6h16" />
        </svg>
      </div>
      <ul tabindex="0" class="menu menu-sm dropdown-content bg-base-100 rounded-box z-[1] mt-3 w-52 p-2 shadow">
        {navLinks.map((link) => (
          <li>
            <a href={link.href} class={currentPath === link.href ? 'active' : ''}>
              {link.label}
            </a>
          </li>
        ))}
      </ul>
    </div>
    <a href="/" class="btn btn-ghost text-xl">Company Name</a>
  </div>
  <div class="navbar-center hidden lg:flex">
    <ul class="menu menu-horizontal px-1">
      {navLinks.map((link) => (
        <li>
          <a href={link.href} class={currentPath === link.href ? 'active' : ''}>
            {link.label}
          </a>
        </li>
      ))}
    </ul>
  </div>
  <div class="navbar-end">
    <div class="dropdown dropdown-end">
      <div tabindex="0" role="button" class="btn btn-ghost btn-circle" aria-label="Theme selector">
        <!-- Sun icon (shown when light theme) -->
        <svg id="theme-icon-light" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
        </svg>
        <!-- Moon icon (shown when dark theme) -->
        <svg id="theme-icon-dark" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
        </svg>
        <!-- System icon (shown when system preference) -->
        <svg id="theme-icon-system" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
        </svg>
      </div>
      <ul tabindex="0" class="dropdown-content menu bg-base-200 rounded-box z-[1] w-36 p-2 shadow-lg mt-2">
        <li>
          <button id="theme-light" class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
            Light
            <span id="check-light" class="ml-auto hidden">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
            </span>
          </button>
        </li>
        <li>
          <button id="theme-dark" class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
            </svg>
            Dark
            <span id="check-dark" class="ml-auto hidden">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
            </span>
          </button>
        </li>
        <li>
          <button id="theme-system" class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
            System
            <span id="check-system" class="ml-auto hidden">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
            </span>
          </button>
        </li>
      </ul>
    </div>
  </div>
</header>

<script>
  function initThemeSelector() {
    const themeLight = document.getElementById('theme-light');
    const themeDark = document.getElementById('theme-dark');
    const themeSystem = document.getElementById('theme-system');

    const iconLight = document.getElementById('theme-icon-light');
    const iconDark = document.getElementById('theme-icon-dark');
    const iconSystem = document.getElementById('theme-icon-system');

    const checkLight = document.getElementById('check-light');
    const checkDark = document.getElementById('check-dark');
    const checkSystem = document.getElementById('check-system');

    function getSystemTheme(): 'light' | 'dark' {
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }

    function applyTheme(preference: 'light' | 'dark' | 'system') {
      const theme = preference === 'system' ? getSystemTheme() : preference;
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme-preference', preference);
      updateUI(preference);
    }

    function updateUI(preference: 'light' | 'dark' | 'system') {
      // Update icons
      iconLight?.classList.add('hidden');
      iconDark?.classList.add('hidden');
      iconSystem?.classList.add('hidden');

      if (preference === 'light') {
        iconLight?.classList.remove('hidden');
      } else if (preference === 'dark') {
        iconDark?.classList.remove('hidden');
      } else {
        iconSystem?.classList.remove('hidden');
      }

      // Update checkmarks
      checkLight?.classList.add('hidden');
      checkDark?.classList.add('hidden');
      checkSystem?.classList.add('hidden');

      if (preference === 'light') {
        checkLight?.classList.remove('hidden');
      } else if (preference === 'dark') {
        checkDark?.classList.remove('hidden');
      } else {
        checkSystem?.classList.remove('hidden');
      }
    }

    // Get current preference
    const currentPreference = (localStorage.getItem('theme-preference') || 'system') as 'light' | 'dark' | 'system';
    updateUI(currentPreference);

    // Event listeners
    themeLight?.addEventListener('click', () => applyTheme('light'));
    themeDark?.addEventListener('click', () => applyTheme('dark'));
    themeSystem?.addEventListener('click', () => applyTheme('system'));

    // Listen for system theme changes when using system preference
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
      const preference = localStorage.getItem('theme-preference') || 'system';
      if (preference === 'system') {
        document.documentElement.setAttribute('data-theme', getSystemTheme());
      }
    });
  }

  initThemeSelector();
  document.addEventListener('astro:after-swap', initThemeSelector);
</script>
